// ============================================
// TRANSLATIONS
// ============================================

const translations = {
    en: {
        baseline: "Strategic Technology Consulting",
        "hero.title": "Strategic Technology Consulting for Streaming Platforms",
        "hero.subtitle": "25+ years building and scaling OTT platforms",
        "cta.contact": "Contact Me",

        // Services
        "services.consulting.title": "Strategic Technology Consulting",
        "services.consulting.description": "Platform architecture, technology stack selection, and go-to-market strategy for streaming services",
        "services.consulting.feature1": "Technology audits and recommendations",
        "services.consulting.feature2": "OTT monetization strategy (SVOD/AVOD/FAST)",
        "services.consulting.feature3": "Cloud infrastructure optimization (AWS/GCP)",
        "services.consulting.feature4": "CDN and encoding architecture",
        "services.consulting.pricing": "From â‚¬1,500/day",

        "services.cto.title": "Fractional CTO Services",
        "services.cto.description": "Part-time strategic technology leadership for media startups and scale-ups",
        "services.cto.feature1": "Ongoing strategic guidance",
        "services.cto.feature2": "Team structure and hiring strategy",
        "services.cto.feature3": "Technology roadmap and prioritization",
        "services.cto.feature4": "Investor and board reporting",
        "services.cto.pricing": "Custom retainer",

        "services.placement.title": "Executive Placement",
        "services.placement.description": "Identify and place top technology leaders (CTO, VP Engineering, Head of Product)",
        "services.placement.feature1": "Proven track record in executive recruitment",
        "services.placement.feature2": "Deep network in streaming/media tech",
        "services.placement.feature3": "Cultural fit assessment",
        "services.placement.feature4": "Compensation benchmarking",
        "services.placement.pricing": "â‚¬15-20K per placement",

        // Social Proof
        "socialProof.label": "Experience includes",
        "socialProof.partnerships": "Partnerships with",

        // Expertise
        "expertise.title": "Core Expertise",
        "expertise.item1": "OTT Platforms (VOD/SVOD/AVOD/FAST)",
        "expertise.item2": "Video Technology (Encoding, DRM, CDN)",
        "expertise.item3": "Cloud Infrastructure (AWS, GCP)",
        "expertise.item4": "Team Scaling",
        "expertise.item5": "International Expansion",
        "expertise.item6": "P&L Management",
        "expertise.item7": "Fundraising",

        // Content
        "content.title": "Thought Leadership",
        "content.newsletter.title": "Streaming Radar",
        "content.newsletter.description": "Weekly insights on the streaming industry. In-depth analysis of OTT trends, platform strategies, and technology innovations. Followed by professionals from Netflix, Amazon Prime Video, Disney+, and other leading streaming services.",
        "content.newsletter.cta": "Subscribe",
        "content.podcast.title": "On va taper dedans",
        "content.podcast.description": "French podcast about Top Chef and culinary competition shows",
        "content.podcast.cta": "Listen",

        // About
        "about.title": "About Ludovic",
        "about.text": "CTO with 25+ years scaling streaming platforms globally. R&D Manager at M6 Web where he created M6 Replay (France's leading catch-up TV service), co-founded Afrostream (Y Combinator Summer 2015), scaled Majelan audio streaming platform. Expert in OTT strategy, platform architecture, and team building. Author of Streaming Radar newsletter and co-host of 'On va taper dedans' podcast.",

        // Contact
        "contact.title": "Ready to discuss your project?",

        // Lead Capture
        "leadCapture.title": "Get a Free 30-Minute Strategy Session",
        "leadCapture.subtitle": "Discuss your OTT project and get actionable recommendations",
        "leadCapture.benefit1": "Review your current platform architecture",
        "leadCapture.benefit2": "Identify optimization opportunities",
        "leadCapture.benefit3": "Get personalized recommendations",
        "leadCapture.benefit4": "No obligation, completely free",
        "leadCapture.badge1": "Y Combinator Alumni",
        "leadCapture.badge2": "25+ Years Experience",
        "leadCapture.badge3": "50M+ Users Served",

        // Form
        "form.fullName": "Full Name *",
        "form.fullNamePlaceholder": "John Doe",
        "form.email": "Email Address *",
        "form.emailPlaceholder": "john@company.com",
        "form.company": "Company Name",
        "form.companyPlaceholder": "Your Company",
        "form.service": "Service Interest *",
        "form.serviceSelect": "Select a service...",
        "form.serviceConsulting": "Strategic Consulting",
        "form.serviceCTO": "Fractional CTO",
        "form.servicePlacement": "Executive Placement",
        "form.serviceOther": "Other",
        "form.budget": "Budget Range *",
        "form.budgetSelect": "Select budget range...",
        "form.budget10k": "< â‚¬10,000",
        "form.budget50k": "â‚¬10,000 - â‚¬50,000",
        "form.budget100k": "â‚¬50,000 - â‚¬100,000",
        "form.budget100kPlus": "> â‚¬100,000",
        "form.budgetNotSure": "Not sure yet",
        "form.message": "Tell me about your project *",
        "form.messagePlaceholder": "Describe your streaming platform needs...",
        "form.submit": "Get Free Consultation",
        "form.errorRequired": "This field is required",
        "form.errorEmail": "Please enter a valid email address"
    },

    fr: {
        baseline: "Conseil StratÃ©gique en Technologies",
        "hero.title": "Conseil StratÃ©gique en Technologies pour Plateformes de Streaming",
        "hero.subtitle": "25+ ans d'expÃ©rience dans la crÃ©ation et le scaling de plateformes OTT",
        "cta.contact": "Me Contacter",

        // Services
        "services.consulting.title": "Conseil StratÃ©gique en Technologies",
        "services.consulting.description": "Architecture de plateforme, sÃ©lection de stack technologique et stratÃ©gie go-to-market pour services de streaming",
        "services.consulting.feature1": "Audits technologiques et recommandations",
        "services.consulting.feature2": "StratÃ©gie de monÃ©tisation OTT (SVOD/AVOD/FAST)",
        "services.consulting.feature3": "Optimisation infrastructure cloud (AWS/GCP)",
        "services.consulting.feature4": "Architecture CDN et encodage",
        "services.consulting.pricing": "Ã€ partir de 1 500â‚¬/jour",

        "services.cto.title": "Services de CTO Ã  Temps Partiel",
        "services.cto.description": "Leadership technologique stratÃ©gique Ã  temps partiel pour startups et scale-ups mÃ©dia",
        "services.cto.feature1": "Accompagnement stratÃ©gique continu",
        "services.cto.feature2": "Structure d'Ã©quipe et stratÃ©gie de recrutement",
        "services.cto.feature3": "Roadmap technologique et priorisation",
        "services.cto.feature4": "Reporting investisseurs et conseil d'administration",
        "services.cto.pricing": "Forfait sur mesure",

        "services.placement.title": "Recrutement de Dirigeants",
        "services.placement.description": "Identifier et placer les meilleurs leaders technologiques (CTO, VP Engineering, Head of Product)",
        "services.placement.feature1": "Historique prouvÃ© en recrutement de dirigeants",
        "services.placement.feature2": "RÃ©seau profond dans les technologies streaming/mÃ©dia",
        "services.placement.feature3": "Ã‰valuation de l'adÃ©quation culturelle",
        "services.placement.feature4": "Benchmarking de rÃ©munÃ©ration",
        "services.placement.pricing": "15-20Kâ‚¬ par placement",

        // Social Proof
        "socialProof.label": "ExpÃ©rience comprenant",
        "socialProof.partnerships": "Partenariats avec",

        // Expertise
        "expertise.title": "Expertises ClÃ©s",
        "expertise.item1": "Plateformes OTT (VOD/SVOD/AVOD/FAST)",
        "expertise.item2": "Technologies VidÃ©o (Encodage, DRM, CDN)",
        "expertise.item3": "Infrastructure Cloud (AWS, GCP)",
        "expertise.item4": "Scaling d'Ã‰quipes",
        "expertise.item5": "Expansion Internationale",
        "expertise.item6": "Gestion P&L",
        "expertise.item7": "LevÃ©es de Fonds",

        // Content
        "content.title": "Leadership d'Opinion",
        "content.newsletter.title": "Streaming Radar",
        "content.newsletter.description": "Analyses hebdomadaires de l'industrie du streaming. Analyse approfondie des tendances OTT, stratÃ©gies de plateformes et innovations technologiques. Suivi par des professionnels de Netflix, Amazon Prime Video, Disney+ et autres grands services de streaming.",
        "content.newsletter.cta": "S'abonner",
        "content.podcast.title": "On va taper dedans",
        "content.podcast.description": "Podcast franÃ§ais sur Top Chef et les Ã©missions culinaires de compÃ©tition",
        "content.podcast.cta": "Ã‰couter",

        // About
        "about.title": "Ã€ Propos de Ludovic",
        "about.text": "CTO avec 25+ ans d'expÃ©rience dans le scaling de plateformes de streaming Ã  l'Ã©chelle mondiale. R&D Manager chez M6 Web oÃ¹ il a crÃ©Ã© M6 Replay (service de catch-up TV leader en France), co-fondateur d'Afrostream (Y Combinator Summer 2015), a fait croÃ®tre la plateforme audio Majelan. Expert en stratÃ©gie OTT, architecture de plateforme et constitution d'Ã©quipes. Auteur de la newsletter Streaming Radar et co-animateur du podcast 'On va taper dedans'.",

        // Contact
        "contact.title": "PrÃªt Ã  discuter de votre projet ?",

        // Lead Capture
        "leadCapture.title": "Obtenez une Session StratÃ©gique Gratuite de 30 Minutes",
        "leadCapture.subtitle": "Discutez de votre projet OTT et recevez des recommandations concrÃ¨tes",
        "leadCapture.benefit1": "Revue de votre architecture de plateforme actuelle",
        "leadCapture.benefit2": "Identification des opportunitÃ©s d'optimisation",
        "leadCapture.benefit3": "Recommandations personnalisÃ©es",
        "leadCapture.benefit4": "Sans engagement, totalement gratuit",
        "leadCapture.badge1": "Y Combinator Alumni",
        "leadCapture.badge2": "25+ Ans d'ExpÃ©rience",
        "leadCapture.badge3": "50M+ Utilisateurs Servis",

        // Form
        "form.fullName": "Nom Complet *",
        "form.fullNamePlaceholder": "Jean Dupont",
        "form.email": "Adresse Email *",
        "form.emailPlaceholder": "jean@entreprise.com",
        "form.company": "Nom de l'Entreprise",
        "form.companyPlaceholder": "Votre Entreprise",
        "form.service": "Service d'IntÃ©rÃªt *",
        "form.serviceSelect": "SÃ©lectionnez un service...",
        "form.serviceConsulting": "Conseil StratÃ©gique",
        "form.serviceCTO": "CTO Ã  Temps Partiel",
        "form.servicePlacement": "Recrutement de Dirigeants",
        "form.serviceOther": "Autre",
        "form.budget": "Budget *",
        "form.budgetSelect": "SÃ©lectionnez votre budget...",
        "form.budget10k": "< 10 000â‚¬",
        "form.budget50k": "10 000â‚¬ - 50 000â‚¬",
        "form.budget100k": "50 000â‚¬ - 100 000â‚¬",
        "form.budget100kPlus": "> 100 000â‚¬",
        "form.budgetNotSure": "Pas encore sÃ»r",
        "form.message": "Parlez-moi de votre projet *",
        "form.messagePlaceholder": "DÃ©crivez les besoins de votre plateforme de streaming...",
        "form.submit": "Obtenir une Consultation Gratuite",
        "form.errorRequired": "Ce champ est obligatoire",
        "form.errorEmail": "Veuillez entrer une adresse email valide"
    },

    zh: {
        baseline: "æˆ˜ç•¥æŠ€æœ¯å’¨è¯¢",
        "hero.title": "æµåª’ä½“å¹³å°æˆ˜ç•¥æŠ€æœ¯å’¨è¯¢",
        "hero.subtitle": "25å¹´ä»¥ä¸ŠOTTå¹³å°æ­å»ºä¸æ‰©å±•ç»éªŒ",
        "cta.contact": "è”ç³»æˆ‘",

        // Services
        "services.consulting.title": "æˆ˜ç•¥æŠ€æœ¯å’¨è¯¢",
        "services.consulting.description": "æµåª’ä½“æœåŠ¡çš„å¹³å°æ¶æ„ã€æŠ€æœ¯æ ˆé€‰æ‹©å’Œå¸‚åœºæ¨è¿›ç­–ç•¥",
        "services.consulting.feature1": "æŠ€æœ¯å®¡è®¡ä¸å»ºè®®",
        "services.consulting.feature2": "OTTå˜ç°ç­–ç•¥ï¼ˆSVOD/AVOD/FASTï¼‰",
        "services.consulting.feature3": "äº‘åŸºç¡€è®¾æ–½ä¼˜åŒ–ï¼ˆAWS/GCPï¼‰",
        "services.consulting.feature4": "CDNå’Œç¼–ç æ¶æ„",
        "services.consulting.pricing": "æ¯æ—¥1500æ¬§å…ƒèµ·",

        "services.cto.title": "å…¼èŒCTOæœåŠ¡",
        "services.cto.description": "ä¸ºåª’ä½“åˆåˆ›å…¬å¸å’Œæˆé•¿å‹ä¼ä¸šæä¾›å…¼èŒæˆ˜ç•¥æŠ€æœ¯é¢†å¯¼æœåŠ¡",
        "services.cto.feature1": "æŒç»­æˆ˜ç•¥æŒ‡å¯¼",
        "services.cto.feature2": "å›¢é˜Ÿç»“æ„ä¸æ‹›è˜ç­–ç•¥",
        "services.cto.feature3": "æŠ€æœ¯è·¯çº¿å›¾ä¸ä¼˜å…ˆçº§è§„åˆ’",
        "services.cto.feature4": "æŠ•èµ„äººä¸è‘£äº‹ä¼šæŠ¥å‘Š",
        "services.cto.pricing": "å®šåˆ¶æœåŠ¡è´¹",

        "services.placement.title": "é«˜ç®¡æ‹›è˜",
        "services.placement.description": "è¯†åˆ«å¹¶å®‰ç½®é¡¶å°–æŠ€æœ¯é¢†å¯¼è€…ï¼ˆCTOã€å·¥ç¨‹å‰¯æ€»è£ã€äº§å“è´Ÿè´£äººï¼‰",
        "services.placement.feature1": "é«˜ç®¡æ‹›è˜é¢†åŸŸç»éªŒä¸°å¯Œ",
        "services.placement.feature2": "æµåª’ä½“/åª’ä½“æŠ€æœ¯é¢†åŸŸæ·±åšäººè„‰",
        "services.placement.feature3": "æ–‡åŒ–å¥‘åˆåº¦è¯„ä¼°",
        "services.placement.feature4": "è–ªé…¬åŸºå‡†åˆ†æ",
        "services.placement.pricing": "æ¯æ¬¡å®‰ç½®15-20Kæ¬§å…ƒ",

        // Social Proof
        "socialProof.label": "å·¥ä½œç»å†åŒ…æ‹¬",
        "socialProof.partnerships": "åˆä½œä¼™ä¼´",

        // Expertise
        "expertise.title": "æ ¸å¿ƒä¸“é•¿",
        "expertise.item1": "OTTå¹³å°ï¼ˆVOD/SVOD/AVOD/FASTï¼‰",
        "expertise.item2": "è§†é¢‘æŠ€æœ¯ï¼ˆç¼–ç ã€DRMã€CDNï¼‰",
        "expertise.item3": "äº‘åŸºç¡€è®¾æ–½ï¼ˆAWSã€GCPï¼‰",
        "expertise.item4": "å›¢é˜Ÿæ‰©å±•",
        "expertise.item5": "å›½é™…æ‰©å¼ ",
        "expertise.item6": "æŸç›Šç®¡ç†",
        "expertise.item7": "èèµ„",

        // Content
        "content.title": "æ€æƒ³é¢†å¯¼åŠ›",
        "content.newsletter.title": "Streaming Radar",
        "content.newsletter.description": "æ¯å‘¨æµåª’ä½“è¡Œä¸šæ·±åº¦æ´å¯Ÿã€‚æ·±å…¥åˆ†æOTTè¶‹åŠ¿ã€å¹³å°ç­–ç•¥å’ŒæŠ€æœ¯åˆ›æ–°ã€‚Netflixã€Amazon Prime Videoã€Disney+ç­‰é¢†å…ˆæµåª’ä½“æœåŠ¡çš„ä¸“ä¸šäººå£«å…³æ³¨ã€‚",
        "content.newsletter.cta": "è®¢é˜…",
        "content.podcast.title": "On va taper dedans",
        "content.podcast.description": "å…³äºTop Chefå’Œçƒ¹é¥ªç«èµ›èŠ‚ç›®çš„æ³•è¯­æ’­å®¢",
        "content.podcast.cta": "æ”¶å¬",

        // About
        "about.title": "å…³äºLudovic",
        "about.text": "æ‹¥æœ‰25å¹´ä»¥ä¸Šå…¨çƒæµåª’ä½“å¹³å°æ‰©å±•ç»éªŒçš„CTOã€‚æ›¾ä»»M6 Webç ”å‘ç»ç†ï¼Œåˆ›å»ºäº†M6 Replayï¼ˆæ³•å›½é¢†å…ˆçš„ç”µè§†å›çœ‹æœåŠ¡ï¼‰ï¼ŒAfrostreamè”åˆåˆ›å§‹äººï¼ˆY Combinator 2015å¤å­£ç­ï¼‰ï¼Œæ‰©å±•äº†MajelanéŸ³é¢‘æµåª’ä½“å¹³å°ã€‚åœ¨OTTæˆ˜ç•¥ã€å¹³å°æ¶æ„å’Œå›¢é˜Ÿå»ºè®¾æ–¹é¢æ‹¥æœ‰ä¸“ä¸šçŸ¥è¯†ã€‚Streaming Radaræ—¶äº‹é€šè®¯ä½œè€…ï¼Œ'On va taper dedans'æ’­å®¢è”åˆä¸»æŒäººã€‚",

        // Contact
        "contact.title": "å‡†å¤‡è®¨è®ºæ‚¨çš„é¡¹ç›®äº†å—ï¼Ÿ",

        // Lead Capture
        "leadCapture.title": "è·å–å…è´¹30åˆ†é’Ÿæˆ˜ç•¥å’¨è¯¢",
        "leadCapture.subtitle": "è®¨è®ºæ‚¨çš„OTTé¡¹ç›®å¹¶è·å¾—å¯è¡Œçš„å»ºè®®",
        "leadCapture.benefit1": "å®¡æŸ¥æ‚¨å½“å‰çš„å¹³å°æ¶æ„",
        "leadCapture.benefit2": "è¯†åˆ«ä¼˜åŒ–æœºä¼š",
        "leadCapture.benefit3": "è·å¾—ä¸ªæ€§åŒ–å»ºè®®",
        "leadCapture.benefit4": "æ— ä¹‰åŠ¡ï¼Œå®Œå…¨å…è´¹",
        "leadCapture.badge1": "Y Combinatoræ ¡å‹",
        "leadCapture.badge2": "25å¹´ä»¥ä¸Šç»éªŒ",
        "leadCapture.badge3": "æœåŠ¡50M+ç”¨æˆ·",

        // Form
        "form.fullName": "å…¨å *",
        "form.fullNamePlaceholder": "å¼ ä¸‰",
        "form.email": "ç”µå­é‚®ä»¶åœ°å€ *",
        "form.emailPlaceholder": "zhang@company.com",
        "form.company": "å…¬å¸åç§°",
        "form.companyPlaceholder": "æ‚¨çš„å…¬å¸",
        "form.service": "æœåŠ¡å…´è¶£ *",
        "form.serviceSelect": "é€‰æ‹©æœåŠ¡...",
        "form.serviceConsulting": "æˆ˜ç•¥å’¨è¯¢",
        "form.serviceCTO": "å…¼èŒCTO",
        "form.servicePlacement": "é«˜ç®¡æ‹›è˜",
        "form.serviceOther": "å…¶ä»–",
        "form.budget": "é¢„ç®—èŒƒå›´ *",
        "form.budgetSelect": "é€‰æ‹©é¢„ç®—èŒƒå›´...",
        "form.budget10k": "< â‚¬10,000",
        "form.budget50k": "â‚¬10,000 - â‚¬50,000",
        "form.budget100k": "â‚¬50,000 - â‚¬100,000",
        "form.budget100kPlus": "> â‚¬100,000",
        "form.budgetNotSure": "å°šæœªç¡®å®š",
        "form.message": "å‘Šè¯‰æˆ‘æ‚¨çš„é¡¹ç›® *",
        "form.messagePlaceholder": "æè¿°æ‚¨çš„æµåª’ä½“å¹³å°éœ€æ±‚...",
        "form.submit": "è·å¾—å…è´¹å’¨è¯¢",
        "form.errorRequired": "æ­¤å­—æ®µä¸ºå¿…å¡«é¡¹",
        "form.errorEmail": "è¯·è¾“å…¥æœ‰æ•ˆçš„ç”µå­é‚®ä»¶åœ°å€"
    }
};

// ============================================
// LANGUAGE SWITCHING
// ============================================

class LanguageSwitcher {
    constructor() {
        this.currentLang = localStorage.getItem('preferred-language') || 'en';
        this.init();
    }

    init() {
        // Set initial language
        this.setLanguage(this.currentLang);

        // Add event listeners to language buttons
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const lang = e.target.dataset.lang;
                this.setLanguage(lang);
            });
        });
    }

    setLanguage(lang) {
        // Validate language
        if (!translations[lang]) {
            console.error(`Language ${lang} not found`);
            return;
        }

        this.currentLang = lang;

        // Save to localStorage
        localStorage.setItem('preferred-language', lang);

        // Update HTML lang attribute
        document.documentElement.lang = lang;

        // Update active button
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.classList.remove('active');
            if (btn.dataset.lang === lang) {
                btn.classList.add('active');
            }
        });

        // Update all text with data-i18n attribute
        this.updatePageText();
    }

    updatePageText() {
        // Update text content elements
        const elements = document.querySelectorAll('[data-i18n]');
        elements.forEach(element => {
            const key = element.dataset.i18n;
            const translation = translations[this.currentLang][key];

            if (translation) {
                // Check if element is an input/textarea
                if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                    element.placeholder = translation;
                } else if (element.tagName === 'OPTION') {
                    element.textContent = translation;
                } else {
                    element.textContent = translation;
                }
            } else {
                console.warn(`Translation not found for key: ${key} in language: ${this.currentLang}`);
            }
        });

        // Update placeholder elements
        const placeholderElements = document.querySelectorAll('[data-i18n-placeholder]');
        placeholderElements.forEach(element => {
            const key = element.dataset.i18nPlaceholder;
            const translation = translations[this.currentLang][key];

            if (translation) {
                element.placeholder = translation;
            }
        });
    }
}

// ============================================
// SCROLL ANIMATIONS
// ============================================

class ScrollAnimations {
    constructor() {
        this.observer = null;
        this.init();
    }

    init() {
        // Create Intersection Observer
        const options = {
            root: null,
            rootMargin: '0px',
            threshold: 0.1
        };

        this.observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, options);

        // Observe all elements with fade-in class
        this.observeElements();
    }

    observeElements() {
        const elements = document.querySelectorAll('.fade-in');
        elements.forEach(element => {
            this.observer.observe(element);
        });
    }
}

// ============================================
// SMOOTH SCROLL
// ============================================

class SmoothScroll {
    constructor() {
        this.init();
    }

    init() {
        // Add smooth scroll to all anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', (e) => {
                const href = anchor.getAttribute('href');

                // Skip if href is just "#"
                if (href === '#' || href === '#privacy' || href === '#terms') {
                    return;
                }

                e.preventDefault();
                const target = document.querySelector(href);

                if (target) {
                    const headerOffset = 80;
                    const elementPosition = target.getBoundingClientRect().top;
                    const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

                    window.scrollTo({
                        top: offsetPosition,
                        behavior: 'smooth'
                    });
                }
            });
        });
    }
}

// ============================================
// IMAGE LAZY LOADING FALLBACK
// ============================================

class LazyLoadImages {
    constructor() {
        this.init();
    }

    init() {
        // Check if browser supports native lazy loading
        if ('loading' in HTMLImageElement.prototype) {
            // Browser supports native lazy loading
            return;
        }

        // Fallback for browsers that don't support native lazy loading
        const images = document.querySelectorAll('img[loading="lazy"]');

        const imageObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    img.src = img.dataset.src || img.src;
                    img.classList.add('loaded');
                    imageObserver.unobserve(img);
                }
            });
        });

        images.forEach(img => imageObserver.observe(img));
    }
}

// ============================================
// HEADER SCROLL EFFECT
// ============================================

class HeaderScroll {
    constructor() {
        this.header = document.querySelector('.header');
        this.init();
    }

    init() {
        let lastScroll = 0;

        window.addEventListener('scroll', () => {
            const currentScroll = window.pageYOffset;

            // Add shadow when scrolled
            if (currentScroll > 50) {
                this.header.style.boxShadow = '0 2px 10px rgba(0, 0, 0, 0.1)';
            } else {
                this.header.style.boxShadow = 'none';
            }

            lastScroll = currentScroll;
        });
    }
}

// ============================================
// ANALYTICS TRACKING
// ============================================

class Analytics {
    constructor() {
        this.scrollDepthTracked = {
            25: false,
            50: false,
            75: false,
            100: false
        };
        this.formStartTracked = {};
        this.init();
    }

    init() {
        this.trackScrollDepth();
        this.trackCTAClicks();
        this.trackFormStarts();
        this.trackOutboundLinks();
    }

    // Track scroll depth milestones
    trackScrollDepth() {
        let ticking = false;

        window.addEventListener('scroll', () => {
            if (!ticking) {
                window.requestAnimationFrame(() => {
                    const windowHeight = window.innerHeight;
                    const documentHeight = document.documentElement.scrollHeight;
                    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                    const scrollPercent = (scrollTop / (documentHeight - windowHeight)) * 100;

                    // Check each milestone
                    [25, 50, 75, 100].forEach(milestone => {
                        if (scrollPercent >= milestone && !this.scrollDepthTracked[milestone]) {
                            this.scrollDepthTracked[milestone] = true;
                            this.sendEvent('scroll_depth', {
                                percent: milestone
                            });
                        }
                    });

                    ticking = false;
                });
                ticking = true;
            }
        });
    }

    // Track CTA button clicks
    trackCTAClicks() {
        const ctaSelectors = '.cta-button, .content-cta';
        document.querySelectorAll(ctaSelectors).forEach(button => {
            button.addEventListener('click', (e) => {
                const ctaText = e.target.textContent.trim();
                const section = this.getParentSection(e.target);
                const ctaType = e.target.classList.contains('cta-button') ? 'primary' : 'secondary';

                this.sendEvent('cta_click', {
                    cta_text: ctaText,
                    cta_location: section,
                    cta_type: ctaType
                });
            });
        });
    }

    // Track form starts (first interaction)
    trackFormStarts() {
        const forms = document.querySelectorAll('form');
        forms.forEach(form => {
            const formId = form.id || 'unnamed-form';
            const formType = form.querySelector('[name="form_type"]')?.value || 'unknown';

            // Track first focus on any input
            const inputs = form.querySelectorAll('input, textarea, select');
            inputs.forEach(input => {
                input.addEventListener('focus', () => {
                    if (!this.formStartTracked[formId]) {
                        this.formStartTracked[formId] = true;
                        this.sendEvent('form_start', {
                            form_id: formId,
                            form_type: formType
                        });
                    }
                }, { once: true });
            });
        });
    }

    // Track outbound link clicks
    trackOutboundLinks() {
        document.querySelectorAll('a[href^="http"]').forEach(link => {
            link.addEventListener('click', (e) => {
                const url = e.target.href;
                const hostname = new URL(url).hostname;

                // Only track if it's an external link
                if (hostname !== window.location.hostname) {
                    this.sendEvent('outbound_click', {
                        link_url: url,
                        link_text: e.target.textContent.trim()
                    });
                }
            });
        });
    }

    // Track form submissions
    trackFormSubmit(formId, formType) {
        this.sendEvent('form_submit', {
            form_id: formId,
            form_type: formType
        });
    }

    // Get parent section name
    getParentSection(element) {
        const section = element.closest('section');
        if (section) {
            return section.className.split(' ')[0] || 'unknown';
        }
        return 'unknown';
    }

    // Send event to Google Analytics and console
    sendEvent(eventName, params = {}) {
        // Log to console for debugging
        console.log(`ğŸ“Š Analytics Event: ${eventName}`, params);

        // Send to Google Analytics if available
        if (typeof gtag !== 'undefined') {
            gtag('event', eventName, params);
        }

        // Placeholder for Facebook Pixel (to be added in SESSION 5)
        if (typeof fbq !== 'undefined') {
            fbq('track', eventName, params);
        }
    }
}

// ============================================
// CONTACT FORM HANDLING
// ============================================

class ContactForm {
    constructor(formId) {
        this.form = document.getElementById(formId);
        if (!this.form) return;

        this.formspreeEndpoint = 'YOUR_FORMSPREE_ENDPOINT'; // Replace with actual Formspree endpoint
        this.submitButton = this.form.querySelector('button[type="submit"]');
        this.submitText = this.submitButton.querySelector('.submit-text');
        this.submitLoader = this.submitButton.querySelector('.submit-loader');
        this.messageContainer = this.form.querySelector('.form-message');

        this.init();
    }

    init() {
        this.form.addEventListener('submit', (e) => this.handleSubmit(e));

        // Add real-time validation
        this.form.querySelectorAll('input, select, textarea').forEach(field => {
            field.addEventListener('blur', () => this.validateField(field));
            field.addEventListener('input', () => {
                // Clear error on input
                const formGroup = field.closest('.form-group');
                if (formGroup) {
                    formGroup.classList.remove('error');
                    const errorSpan = formGroup.querySelector('.form-error');
                    if (errorSpan) errorSpan.textContent = '';
                }
            });
        });
    }

    async handleSubmit(e) {
        e.preventDefault();

        // Validate all fields
        if (!this.validateForm()) {
            return;
        }

        // Show loading state
        this.setLoading(true);

        try {
            const formData = new FormData(this.form);

            // Check if Formspree endpoint is configured
            if (this.formspreeEndpoint === 'YOUR_FORMSPREE_ENDPOINT') {
                // Simulate success for demo purposes
                console.warn('âš ï¸ Formspree endpoint not configured. Form submission simulated.');
                await new Promise(resolve => setTimeout(resolve, 1500));

                // Track event
                if (window.analytics) {
                    window.analytics.trackFormSubmit(this.form.id, formData.get('form_type'));
                }

                this.showMessage('success', 'âœ“ Thank you! I\'ll get back to you within 24 hours.');
                this.form.reset();
            } else {
                // Actual Formspree submission
                const response = await fetch(this.formspreeEndpoint, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                if (response.ok) {
                    // Track event
                    if (window.analytics) {
                        window.analytics.trackFormSubmit(this.form.id, formData.get('form_type'));
                    }

                    this.showMessage('success', 'âœ“ Thank you! I\'ll get back to you within 24 hours.');
                    this.form.reset();
                } else {
                    throw new Error('Form submission failed');
                }
            }
        } catch (error) {
            console.error('Form submission error:', error);
            this.showMessage('error', 'âœ— Something went wrong. Please try again or email me directly at lbostral@gmail.com');
        } finally {
            this.setLoading(false);
        }
    }

    validateForm() {
        let isValid = true;
        const fields = this.form.querySelectorAll('input[required], select[required], textarea[required]');

        fields.forEach(field => {
            if (!this.validateField(field)) {
                isValid = false;
            }
        });

        return isValid;
    }

    validateField(field) {
        const formGroup = field.closest('.form-group');
        const errorSpan = formGroup?.querySelector('.form-error');
        let errorMessage = '';

        // Check if required field is empty
        if (field.hasAttribute('required') && !field.value.trim()) {
            errorMessage = translations[window.languageSwitcher?.currentLang || 'en']['form.errorRequired'] || 'This field is required';
        }
        // Validate email format
        else if (field.type === 'email' && field.value.trim()) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(field.value)) {
                errorMessage = translations[window.languageSwitcher?.currentLang || 'en']['form.errorEmail'] || 'Please enter a valid email address';
            }
        }

        if (errorMessage) {
            formGroup?.classList.add('error');
            if (errorSpan) errorSpan.textContent = errorMessage;
            return false;
        } else {
            formGroup?.classList.remove('error');
            if (errorSpan) errorSpan.textContent = '';
            return true;
        }
    }

    setLoading(isLoading) {
        this.submitButton.disabled = isLoading;

        if (isLoading) {
            this.submitText.style.display = 'none';
            this.submitLoader.style.display = 'inline';
        } else {
            this.submitText.style.display = 'inline';
            this.submitLoader.style.display = 'none';
        }
    }

    showMessage(type, message) {
        this.messageContainer.textContent = message;
        this.messageContainer.className = `form-message ${type}`;
        this.messageContainer.style.display = 'block';

        // Auto-hide after 5 seconds
        setTimeout(() => {
            this.messageContainer.style.display = 'none';
        }, 5000);
    }
}

// ============================================
// INITIALIZE APP
// ============================================

document.addEventListener('DOMContentLoaded', () => {
    // Initialize all modules
    window.languageSwitcher = new LanguageSwitcher();
    new ScrollAnimations();
    new SmoothScroll();
    new LazyLoadImages();
    new HeaderScroll();

    // Initialize Analytics
    window.analytics = new Analytics();

    // Initialize Contact Form
    new ContactForm('contactForm');

    // Log initialization
    console.log('ğŸš€ Ludovic Bostral Consulting Website Initialized');
    console.log('ğŸ“§ Contact: lbostral@gmail.com');
    console.log('ğŸ”— LinkedIn: https://linkedin.com/in/ludovicbostral');
    console.log('ğŸ“° Newsletter: https://streamingradar.substack.com');
});

// ============================================
// PERFORMANCE MONITORING (Development Only)
// ============================================

if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
    window.addEventListener('load', () => {
        const perfData = window.performance.timing;
        const pageLoadTime = perfData.loadEventEnd - perfData.navigationStart;
        console.log(`â±ï¸ Page Load Time: ${pageLoadTime}ms`);
    });
}

// ============================================
// ANALYTICS PLACEHOLDER
// ============================================

// Add your analytics code here (Google Analytics, Plausible, etc.)
// Example:
// window.dataLayer = window.dataLayer || [];
// function gtag(){dataLayer.push(arguments);}
// gtag('js', new Date());
// gtag('config', 'GA_MEASUREMENT_ID');
